{"version":3,"sources":["../../src/Pos.ts","../../src/Dim.ts","../../src/Msg.ts","../../src/Menu.ts","../../src/Model.ts","../../src/Box.ts","../../src/StopEvent.ts","../../src/index.ts","../../src/TeaPop.ts","../../src/Popover.ts","../../src/ViewMenu.tsx","../../src/ItemRenderer.tsx","Demo.tsx","App.tsx","index.tsx"],"names":["Pos","x","y","p","this","pos","origin","Dim","w","h","tag","d","uuid","r","key","m","item","subMenuCounter","selectFirst","Menu","elements","selectIndex","select","e","ListWithSelection","fromArray","toArray","isSelected","start","elems","i","length","just","nothing","down","getSelectedIndex","map","selectedIndex","findNextItemIndex","findPreviousItemIndex","nextIndex","withDefault","withDefaultSupply","indexOf","selected","getSelected","type","value","menuId","btoa","menuItemId","itemIndex","byId","id","Task","fromLambda","document","getElementById","Error","items","userData","subMenu","maybeOf","separator","menuStatePlacing","position","menu","windowSize","state","error","child","navigatedWithKeyboard","model","Box","rect","height","width","box","dim","stopEvent","preventDefault","stopPropagation","open","initialModel","selectFirstItem","deselectAll","Cmd","batch","perform","getWindowDimensions","gotWindowDimensions","u","gotUuid","postOpen","noCmd","attempt","menuTask","fromDomRect","getBoundingClientRect","gotMenuBox","withOut","mac","outMsg","outItemSelected","data","openSubMenu","isNothing","Tuple","t2n","menuItemTask","gotItemBox","update","msg","match","adjustPopover","err","collapseLastSubMenu","keyboardNavigated","mapLastMenu","lastModel","moveSelection","selectedItem","indexOfItem","expandLastSubMenu","toggleOrSelectItem","newModel","selectItem","isJust","itemBox","add","newModel2","childMsg","mco","windowEvents","WindowEvents","documentEvents","DocumentEvents","Sub","on","window","innerWidth","innerHeight","evt","button","noop","t","target","classList","contains","parentElement","docMouseDown","gotKeyDown","none","succeedLazy","f","fromNative","mapFirst","c","mapSecond","cmd","toNative","viewport","elem","vh","vw","newY","newH","overflowDown","newX","newW","overflowRight","ViewMenuItem","props","renderer","dispatch","onMouseEnter","onMouseLeave","onClick","active","hasSubMenu","ViewMenu","renderItems","element","index","className","style","top","left","bottom","right","overflow","onContextMenu","visibility","contentRenderer","input","activeClass","menuMsg","mySubMenu2","mySubMenu1","myMenu","MyRenderer","defaultItemRenderer","s","init","menuModel","lastClicked","mousePos","view","TM","onMouseDown","out","closeMenu","updateMenu","subscriptions","menuSub","mm","mouseMove","pageX","pageY","keyDown","mc","App","Demo","devTools","DevTools","ReactDOM","render","StrictMode"],"mappings":"uLAyBaA,E,WACX,WACaC,EACAC,GAAS,UADT,KAAAD,IACA,KAAAC,I,sCAITC,GACF,OAAO,IAAIH,EACTI,KAAKH,EAAIE,EAAEF,EACXG,KAAKF,EAAIC,EAAED,O,KAOjB,SAAgBG,EAAIJ,EAAWC,GAC7B,OAAO,IAAIF,EAAIC,EAAGC,GAlBpB,QAcS,EAAAI,OAAcD,EAAI,EAAG,GAG9B,S,mHCjBaE,EACX,WACaC,EACAC,GAAS,UADT,KAAAD,IACA,KAAAC,KAHf,QAQA,eAAoBD,EAAWC,GAC7B,OAAO,IAAIF,EAAIC,EAAGC,K,gMCSpB,kBACE,MAAO,CAAEC,IAAK,SAGhB,+BAAuCC,GACrC,MAAO,CACLD,IAAK,wBACLC,MAIJ,mBAA2BC,GACzB,MAAO,CACLF,IAAK,WACLE,SAIJ,sBAA8BC,GAC5B,MAAO,CACLH,IAAK,eACLG,MAIJ,sBAA8BC,GAC5B,MAAO,CACLJ,IAAK,WACLI,QAIJ,oBAA4BC,GAC1B,MAAO,CACLL,IAAK,YACLK,MAIJ,sBAA8BC,EAAmBH,EAAsBI,EAAwBC,GAC7F,MAAO,CACLR,IAAK,eACLM,OACAE,cACAL,IACAI,mBAIJ,0BACE,MAAO,CACLP,IAAK,oB,2LCrET,WASaS,E,WACX,WAA6BC,GAA2C,UAA3C,KAAAA,W,oDAG3B,OAAO,IAAID,EAAKf,KAAKgB,SAASC,YAAY,M,iCAGjCL,GACT,OAAO,IAAIG,EAAKf,KAAKgB,SAASE,QAAO,SAACC,GAAD,OAAOA,IAAMP,Q,oCAIlD,OAAO,IAAIG,EAAK,EAAAK,kBAAkBC,UAAUrB,KAAKgB,SAASM,c,iCAejDV,GACT,OAAOZ,KAAKgB,SAASO,WAAWX,K,wCAGRY,GAGxB,IAFA,IAAMC,EAAQzB,KAAKyB,MAEVC,EADCF,IAAUC,EAAME,OAAS,EAAI,EAAIH,EAAQ,EACnCE,EAAID,EAAME,OAAQD,IAChC,GAAqB,SAAjBD,EAAMC,GAAGpB,IACX,OAAO,EAAAsB,KAAKF,GAGhB,OAAO,EAAAG,U,4CAGqBL,GAG5B,IAFA,IAAMC,EAAQzB,KAAKyB,MAEVC,EADW,IAAVF,EAAcC,EAAME,OAAS,EAAIH,EAAQ,EACnCE,GAAK,EAAGA,IACtB,GAAqB,SAAjBD,EAAMC,GAAGpB,IACX,OAAO,EAAAsB,KAAKF,GAGhB,OAAO,EAAAG,U,oCAGKC,GAAa,WACzB,OAAO9B,KAAKgB,SACTe,mBACAC,KAAI,SAACC,GAIJ,OAHoBH,EAChB,EAAKI,kBAAkBD,GACvB,EAAKE,sBAAsBF,IAE5BD,KAAI,SAACI,GAAD,OAAe,IAAIrB,EAAK,EAAKC,SAASC,YAAYmB,OACtDC,YAAY,MAEhBC,mBAAkB,WACjB,OAAO,IAAIvB,EACT,EAAKC,SAASC,YAAYa,EAAO,EAAI,EAAKd,SAASW,SAAW,S,kCAK1Df,GACV,IAAMc,EAAI1B,KAAKgB,SAASM,UAAUiB,QAAQ3B,GAC1C,OAAW,IAAPc,EACK,EAAAG,QAEF,EAAAD,KAAKF,K,4BA5DZ,OAAO1B,KAAKgB,SAASM,Y,mCAIrB,IAAMkB,EAAWxC,KAAKgB,SAASyB,cAC/B,MAAsB,SAAlBD,EAASE,MAA0C,SAAvBF,EAASG,MAAMrC,IACtC,EAAAsB,KAAKY,EAASG,OAEhB,EAAAd,Y,KAoFX,SAAgBe,EAAOpC,GACrB,mBAAaqC,KAAKrC,IAGpB,SAAgBsC,EAAWF,EAAgBG,GACzC,wBAAkBH,EAAlB,YAA4BG,GAc9B,SAASC,EAAKC,GACZ,OAAO,EAAAC,KAAKC,YAAW,WACrB,IAAMhC,EAAIiC,SAASC,eAAeJ,GAClC,GAAU,OAAN9B,EACF,MAAM,IAAImC,MAAM,6BAA+BL,GAEjD,OAAO9B,KArIX,SA4FA,gBAAwBoC,GACtB,OAAO,IAAIxC,EAAK,EAAAK,kBAAkBC,UAAUkC,KAG9C,gBAAwBC,EAAaC,GACnC,MAAO,CACLnD,IAAK,OACLkD,WACAC,QAAS,EAAAC,QAAQD,KAIR,EAAAE,UAA2B,CACtCrD,IAAK,aAGP,WAIA,eAIA,oBAAyBE,GACvB,OAAOwC,EAAKJ,EAAOpC,KAGrB,wBACEoC,EACAG,GAEA,OAAOC,EAAKF,EAAWF,EAAQG,M,8ICpIjC,WAiCA,SAAgBa,EAAiBC,GAC/B,MAAO,CACLvD,IAAK,UACLuD,YApBJ,wBAAgCC,EAAeD,GAC7C,MAAO,CACLrD,KAAM,EAAAqB,QACNkC,WAAY,EAAAlC,QACZiC,OACAE,MAAOJ,EAAiBC,GACxBI,MAAO,EAAApC,QACPqC,MAAO,EAAArC,QACPsC,uBAAuB,EACvBtD,eAAgB,IAQpB,qBAOA,6BAAqCuD,GAAsD,IAArCD,IAAqC,yDACzF,sCAAWC,GAAK,CAAED,4B,sHC1CnB,YACD,QAEaE,E,WACX,WACatE,EACAQ,GAAM,UADN,KAAAR,IACA,KAAAQ,I,mDAIM+D,GAAa,IACvBzE,EAAuByE,EAAvBzE,EAAGC,EAAoBwE,EAApBxE,EAAGyE,EAAiBD,EAAjBC,OAAQC,EAASF,EAATE,MACrB,OAAOC,EAAI,EAAAxE,IAAIJ,EAAEC,GAAI,EAAA4E,IAAIF,EAAOD,Q,KAKpC,SAAgBE,EAAI1E,EAAQQ,GAC1B,OAAO,IAAI8D,EAAItE,EAAGQ,GAfpB,QAcA,S,oGCfa,EAAAoE,UAA+B,SAAAxD,GAC1CA,EAAEyD,iBACFzD,EAAE0D,oB,uaCJJ,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,Y,kKCTA,YAWA,OACA,QACA,QACA,QACA,QACA,QACA,QAGA,SAAgBC,EAAQhB,EAAeD,GAA2C,IAA5B/C,EAA4B,wDAChF,MAAO,CACL,EAAAiE,aAAajE,EAAcgD,EAAKkB,kBAAoBlB,EAAKmB,cAAepB,GACxE,EAAAqB,IAAIC,MAAM,CACR,EAAAjC,KAAKkC,QAAQC,GAAqB,SAAC9E,GAAD,OAAO,EAAA+E,oBAAoB/E,MAC7D,EAAA2C,KAAKkC,QAAQ,EAAA5E,QAAQ,SAAC+E,GAAD,OAAO,EAAAC,QAAQD,SAK1C,SAASE,EACLrB,GAEF,MAAwB,YAApBA,EAAM5D,KAAKkC,MAGe,YAA1B0B,EAAML,WAAWrB,KAFZ,EAAAgD,MAAMtB,GASR,CAACA,EAJiB,EAAAlB,KAAKyC,QAC1B,EAAAC,SAASxB,EAAM5D,KAAKmC,OAAOX,KAAI,SAACb,GAAD,OAAO,EAAAkD,IAAIwB,YAAY1E,EAAE2E,6BACxD,SAACjG,GAAD,OAAO,EAAAkG,WAAWlG,OAKxB,SAASmG,EAAWC,GAAgE,IAAlCC,EAAkC,uDAAP,EAAArE,QAC3E,MAAO,CAACoE,EAAI,GAAIA,EAAI,GAAIC,GA2J1B,SAASC,EAAmBvF,GAC1B,OAAO,EAAAgB,KAAK,CAACtB,IAAI,gBAAiB8F,KAAMxF,EAAK4C,WAG/C,SAAS6C,EACLjC,EACAxB,EACAhC,EACAmC,EACAjC,GAEF,GAAIF,EAAK6C,QAAQ6C,YACf,OAAO,EAAAZ,MAAMtB,GAEf,IAAMvD,EAAiBuD,EAAMvD,eAAiB,EAC9C,OAAO,EAAA0F,MAAMC,IAAG,+BACPpC,GAAK,CAAEvD,mBACZ,EAAAqC,KAAKyC,QACH,EAAAc,aAAa7D,EAAQG,GAAWf,KAAI,SAACb,GACnC,OAAO,EAAAkD,IAAIwB,YAAY1E,EAAE2E,6BAE3B,SAACrF,GAAD,OAAO,EAAAiG,WAAW9F,EAAMH,EAAGI,EAAgBC,OA3MnD,SA8BA,kBAAgB6F,EACZC,EACAxC,GAEF,OAAQwC,EAAItG,KACV,IAAK,wBACH,OAAO0F,EAAQP,EAAS,OAAD,wBAClBrB,GAAK,CACRL,WAAY,EAAAnC,KAAKgF,EAAIrG,OAGzB,IAAK,WACH,OAAOyF,EAAQP,EAAS,OAAD,wBAClBrB,GAAK,CACR5D,KAAM,EAAAoB,KAAKgF,EAAIpG,UAGnB,IAAK,eACH,OAAOwF,EAAQ,EAAAN,MACXtB,EAAML,WACD/B,KAAI,SAAC+B,GAeJ,OAd2B6C,EAAInG,EAAEoG,OAC7B,SAACpC,GAAD,OACK,+BACIL,GAAK,CACRJ,MAAO,CACL1D,IAAK,OACLmE,IAAK,EAAAqC,cAAc/C,EAAYU,SAGvC,SAACsC,GAAD,OAAS,+BACJ3C,GAAK,CACRH,MAAO,EAAArC,KAAKmF,WAKnB1E,YAAY+B,KAIvB,IAAK,WACH,OAAQwC,EAAIlG,KACV,IAAK,SACH,OAAOsF,EACHgB,EAAoB,EAAAC,kBAAkB7C,IACtCA,EAAMF,MAAMoC,YAAc,EAAA1E,KAAK,CAAEtB,IAAK,kBAAqB,EAAAuB,SAGjE,IAAK,YACL,IAAK,UACH,OAAOqF,EAAY,EAAAD,kBAAkB7C,IAAQ,SAAC+C,GAC5C,OAAOnB,EAAQ,EAAAN,MAAK,+BACfyB,GAAS,CACZrD,KAAMqD,EAAUrD,KAAKsD,cAA0B,cAAZR,EAAIlG,YAI7C,IAAK,YACH,OAAOsF,EAAQgB,EAAoB,EAAAC,kBAAkB7C,KACvD,IAAK,aACH,OA2LV,SAA8BA,GAC5B,OAAO8C,EAAY9C,GAAO,SAAC+C,GACzB,OAAOA,EAAUrD,KAAKuD,aACjBrF,KAAI,SAACqF,GACJ,OAAOA,EAAa5D,QACfzB,KAAI,WACH,GAA4B,YAAxBmF,EAAU3G,KAAKkC,KACjB,OAAOsD,EAAQ,EAAAN,MAAwByB,IAEzC,IAAM3G,EAAO2G,EAAU3G,KAAKmC,MAQ5B,OAAOqD,EANPmB,EAAUrD,KACLwD,YAAYD,GACZrF,KAAI,SAACe,GACJ,OAAOsD,EAAYc,EAAW3G,EAAM6G,EAActE,GAAW,MAE9DT,mBAAkB,kBAAM,EAAAoD,MAAMyB,UAGpC7E,mBAAkB,WACjB,OAAO0D,EAAQ,EAAAN,MAAMyB,UAG5B7E,mBAAkB,WACjB,OAAO0D,EAAQ,EAAAN,MAAMyB,UAnNdI,CAAkB,EAAAN,kBAAkB7C,IAC7C,IAAK,QACL,IAAK,IACH,OAqNV,SAA+BA,GAC7B,OAAO8C,EAAY9C,GAAO,SAAC+C,GACzB,OAAOA,EAAUrD,KAAKuD,aACjBrF,KAAI,SAAAqF,GACH,GAA4B,YAAxBF,EAAU3G,KAAKkC,KACjB,OAAOsD,EAAQ,EAAAN,MAAuByB,IAExC,IAAM3G,EAAO2G,EAAU3G,KAAKmC,MAE5B,OAAO0E,EAAa5D,QACfzB,KAAI,WAMH,OAAOgE,EAJ8BmB,EAAUrD,KAC1CwD,YAAYD,GACZrF,KAAI,SAAAe,GAAS,OAAIsD,EAAYc,EAAW3G,EAAM6G,EAActE,GAAW,MACvET,mBAAkB,kBAAM,EAAAoD,MAAMyB,UAGpC7E,mBAAkB,WAEjB,OAAO0D,EAAQ,EAAAN,MAAMyB,GAAYhB,EAAgBkB,UAIxD/E,mBAAkB,kBAAM0D,EAAQ,EAAAN,MAAMyB,UA7O9BK,CAAmBpD,GAE5B,QACE,OAAO4B,EAAQ,EAAAN,MAAMtB,IAG3B,IAAK,cACH,IAAMqD,EAAW,OAAH,wBAAQrD,GAAK,CAAEvD,eAAgBuD,EAAMvD,eAAiB,IACpE,GAAIuD,EAAMD,sBACR,OAAO6B,EAAQ,EAAAN,MAAM,EAAAuB,kBAAkBQ,GAAU,KAEnD,GAAwB,YAApBrD,EAAM5D,KAAKkC,KACb,OAAOsD,EAAQ,EAAAN,MAAM+B,IAEvB,IAAM3D,EAAOM,EAAMN,KAAK4D,WAAWd,EAAIhG,MACjCJ,EAAO4D,EAAM5D,KAAKmC,MACxB,OAAOqD,EACHK,EAAY,OAAD,wBAAKoB,GAAQ,CAAE3D,OAAMI,MAAO,EAAArC,UAAUrB,EAAMoG,EAAIhG,KAAMgG,EAAI7D,WAAW,IAGtF,IAAK,cACH,OAAOiD,EACH,EAAAN,MACItB,EAAMF,MAAMyD,SACRvD,EACD,+BAAMA,GAAK,CAAEN,KAAMM,EAAMN,KAAKmB,kBAI3C,IAAK,eACH,OAAI2B,EAAI/F,iBAAmBuD,EAAMvD,eACxBmF,EAAQ,EAAAN,MAAMtB,IAEhB4B,EAAQY,EAAInG,EAAEoG,OACnB,SAACe,GACC,IAAMH,EAAQ,+BACTrD,GAAK,CACRN,KAAMM,EAAMN,KAAK4D,WAAWd,EAAIhG,QAElC,OAAOgG,EAAIhG,KAAK6C,QACXzB,KAAI,SAACyB,GAGJ,IAAMwC,EAAMnB,EACRrB,EACAmE,EAAQ7H,EAAE8H,IAAI,EAAA5H,IAAI2H,EAAQrH,EAAEH,EAAG,IAC/BwG,EAAI9F,aAEFgH,EAAS,+BACVL,GAAQ,CACXvD,MAAO,EAAAtC,KAAKqE,EAAI,MAElB,OAAO,EAAAM,MAAMC,IAAIsB,EAAW7B,EAAI,GAAGjE,IAAI,EAAA+F,cAExCzF,mBAAkB,WAEjB,OAAOmF,EAASvD,MACXlC,KAAI,kBAAM,EAAA0D,MAAK,+BAAuBtB,GAAK,CAAEF,MAAO,EAAArC,cACpDS,mBAAkB,kBAAM,EAAAoD,MAAMtB,YAG3C,SAAC2C,GAAD,OAAS,EAAArB,MAAK,+BAAKtB,GAAK,CAAEH,MAAO,EAAArC,KAAKmF,UAG1C,IAAK,YACH,OAAO3C,EAAMF,MACRlC,KAAI,SAACkC,GACJ,IAAM8D,EAAMrB,EAAOC,EAAIjG,EAAGuD,GACpBuD,EAAQ,+BACTrD,GAAK,CACRF,MAAO,EAAAtC,KAAKoG,EAAI,MAElB,OAAOhC,EAAQ,EAAAO,MAAMC,IAAIiB,EAAUO,EAAI,GAAGhG,IAAI,EAAA+F,WAAYC,EAAI,OAE/D1F,mBAAkB,kBAAM0D,EAAQ,EAAAN,MAAMtB,OAE7C,IAAK,eACH,OAAO4B,EAAQ,EAAAN,MAAMtB,GAAQ+B,EAAgBS,EAAIhG,OAEnD,IAAK,iBACH,OAAOoF,EAAQ,EAAAN,MAAMtB,GAAQ,EAAAxC,KAAK,CAACtB,IAAK,mBAE1C,IAAK,OACH,OAAO0F,EAAQ,EAAAN,MAAMtB,MA+B3B,IAAM6D,EAAe,IAAI,EAAAC,aACnBC,EAAiB,IAAI,EAAAC,eAE3B,yBAAiChE,GAC/B,OAAO,EAAAiE,IAAIlD,MAAM,CACf8C,EAAaK,GAAG,UAAU,kBACtB,EAAAhD,oBAAoB,EAAAZ,IAAI6D,OAAOC,WAAYD,OAAOE,iBAEtDN,EAAeG,GAAG,aAAa,SAACI,GAC9B,GAAmB,IAAfA,EAAIC,OACN,OAAO,EAAAC,OAGT,IADA,IAAIC,EAAwBH,EAAII,OACzBD,GAAG,CAER,GAAIA,EAAEE,UAAUC,SAAS,MACvB,OAAO,EAAAJ,OAETC,EAAIA,EAAEI,cAER,OAAO,EAAAC,kBAEW,SAApB9E,EAAMJ,MAAM1D,IACN6H,EAAeG,GAAG,WAAW,SAACnH,GAAD,OAAO,EAAAgI,WAAWhI,EAAET,QACjD,EAAA2H,IAAIe,UAId,IAAM/D,EAAwC,EAAAnC,KAAKmG,aAAY,kBAC3D,EAAA3E,IAAI6D,OAAOC,WAAYD,OAAOE,gBAGlC,SAASvB,EACL9C,EACAkF,GAEF,OAAQlF,EAAMF,MAAMxB,MAClB,IAAK,UAEH,OAAO4G,EAAElF,GAEX,IAAK,OACH,IAAM6B,EAAMiB,EAAY9C,EAAMF,MAAMvB,MAAO2G,GAC3C,MAAO,CAAC,OAAD,wBAAKlF,GAAK,CAAEF,MAAO,EAAAtC,KAAKqE,EAAI,MAAMA,EAAI,GAAGjE,IAAI,EAAA+F,UAAW9B,EAAI,KAKzE,SAASe,EAAuB5C,GAC9B,OAAQA,EAAMF,MAAMxB,MAClB,IAAK,UACH,OAAO,EAAAgD,MAAMtB,GACf,IAAK,OAEH,IAAMF,EAAQE,EAAMF,MAAMvB,MAC1B,OAAIuB,EAAMA,MAAMyD,SACP,EAAApB,MAAMgD,WAAWvC,EAAoB9C,IACvCsF,UAAS,SAAAC,GAAC,OAAI,+BAAKrF,GAAK,CAAEF,MAAO,EAAAtC,KAAK6H,QACtCC,WAAU,SAAAC,GAAG,OAAIA,EAAI3H,IAAI,EAAA+F,aACzB6B,WAEE,EAAAlE,MAAK,+BACPtB,GAAK,CACRF,MAAO,EAAArC,c,wGCnSjB,YACA,QACA,QAEA,yBAA8BgI,EAAeC,GAAS,MAIrCA,EAAK/J,EAAbF,EAJ6C,EAI7CA,EAAGC,EAJ0C,EAI1CA,EAJ0C,EAKrCgK,EAAKvJ,EAAbF,EAL6C,EAK7CA,EAAGD,EAL0C,EAK1CA,EACA2J,EAAaF,EAAfxJ,EAAQ2J,EAAOH,EAATzJ,EAEV6J,EAAOnK,EACPoK,EAAO7J,EACL8J,EAAgBrK,EAAIO,EAAK0J,EAC3BI,EAAe,IAEbrK,EAAIqK,EAENF,EAAOnK,EAAIqK,GAGXF,EAAO,EACPC,EAAOH,IAIX,IAAIK,EAAOvK,EACPwK,EAAOjK,EACLkK,EAAiBzK,EAAIO,EAAK4J,EAYhC,OAXIM,EAAgB,IAEdzK,EAAIyK,EAENF,EAAOvK,EAAIyK,GAEXF,EAAO,EACPC,EAAOL,IAIJ,EAAAvF,IAAI,EAAAxE,IAAImK,EAAMH,GAAO,EAAAvF,IAAI2F,EAAMH,M,qoBCzCxC,cACA,QACA,QACA,OAGA,QAgHA,SAAgBK,EAAgBC,GAA2B,IAClD1G,EAAmD0G,EAAnD1G,KAAMlD,EAA6C4J,EAA7C5J,KAAM6J,EAAuCD,EAAvCC,SAAUC,EAA6BF,EAA7BE,SAAUlK,EAAmBgK,EAAnBhK,KAAMuC,EAAayH,EAAbzH,UACvCP,EAAWsB,EAAKvC,WAAWX,GACjC,OACI,uBACIqC,GAAI,EAAAH,WAAWtC,EAAMuC,GACrB4H,aAAc,kBAAMD,EAAS,CAAEpK,IAAK,cAAeM,OAAMmC,eACzD6H,aAAc,kBAAMF,EAAS,CAAEpK,IAAK,cAAeM,OAAMmC,eACzD8H,QAAS,WACPH,EAAS,CAACpK,IAAK,eAAgBM,WAGlC6J,EAAS,CACRrE,KAAMxF,EAAK4C,SACXsH,OAAQtI,EACRuI,WAAYnK,EAAK6C,QAAQkE,YAvHnC,oBAAgBqD,EAAYR,GAAuB,IAC1CpG,EAA6BoG,EAA7BpG,MAAOsG,EAAsBF,EAAtBE,SAAUD,EAAYD,EAAZC,SACjB3G,EAAiCM,EAAjCN,KAAME,EAA2BI,EAA3BJ,MAAOxD,EAAoB4D,EAApB5D,KAAMuD,EAAcK,EAAdL,WAC1B,GAAkB,YAAdvD,EAAKkC,KACP,OAAO,iCAET,GAAwB,YAApBqB,EAAWrB,KACb,OAAO,iCAGT,IAAMuI,EAAc,kBAAMnH,EAAKrC,MAAMO,KAAI,SAACkJ,EAASC,GACjD,OAAQD,EAAQ5K,KACd,IAAK,OACH,OACI,gBAACiK,EAAY,eACT7J,IAAG,eAAUyK,GACb3K,KAAMA,EAAKmC,MACXI,UAAWoI,EACXrH,KAAMA,EACNlD,KAAMsK,GACFV,IAId,IAAK,YACH,OACI,uBAAK9J,IAAG,cAASyK,GAASC,UAAU,sBAM9C,OAAQpH,EAAM1D,KACZ,IAAK,UAAW,IACPuD,EAAYG,EAAZH,SACP,OACI,uBACIuH,UAAU,YACVC,MAAO,CACLxH,SAAU,WACVyH,IAAK,EACLC,KAAM,EACNC,OAAQ,EACRC,MAAO,EACPC,SAAU,UAEZC,cAAe,EAAAhH,WAEjB,uBACIyG,UAAU,KACVnI,GAAI,EAAAL,OAAOpC,EAAKmC,OAChB0I,MAAO,CACLxH,SAAU,WACVyH,IAAKzH,EAAS/D,EACdyL,KAAM1H,EAAShE,EACf+L,WAAY,UAEdD,cAAe,EAAAhH,WAEhBsG,MAKX,IAAK,OAAQ,IACJxG,EAAOT,EAAPS,IACA1E,EAAQ0E,EAAR1E,EAAGQ,EAAKkE,EAALlE,EACV,OACI,gCACE,uBACI6K,UAAU,KACVnI,GAAI,EAAAL,OAAOpC,EAAKmC,OAChB0I,MAAO,CACLxH,SAAU,WACVyH,IAAKvL,EAAED,EACPyL,KAAMxL,EAAEF,EACR2E,MAAOjE,EAAEH,EACTmE,OAAQhE,EAAEF,GAEZsL,cAAe,EAAAhH,WAEhBsG,KAEF7G,EAAMF,MACFlC,KAAI,SAAAkC,GAAK,OACN,gBAAC8G,EAAQ,CAAC5G,MAAOF,EAAOwG,SAAU,EAAA1I,IAAI0I,EAAU,EAAA3C,UAAW0C,SAAUA,OAExEnI,mBAAkB,kBAAM,uCAiBzC,kB,mtBCtHA,cAUA,+BAAuCuJ,GACrC,OAAO,SAACC,GAAS,IACP1F,EAA6B0F,EAA7B1F,KAAM0E,EAAuBgB,EAAvBhB,OAAQC,EAAee,EAAff,WAChBgB,EAAcjB,EAAS,aAAe,GAC5C,OACI,uBAAKM,UAAS,iBAAYW,IACxB,uBAAKX,UAAU,oBACZS,EAAgBzF,IAEjB2E,EAEM,uBAAKK,UAAU,oBAAkB,UAInC,qC,+GCtBhB,SAASY,EAAQpF,GACf,MAAO,CACLtG,IAAK,WACLsG,OA6BJ,IAAMqF,EAA2BnI,eAAK,CACpClD,eAAK,OACLA,eAAK,aAGDsL,EAA2BpI,eAAK,CACpClD,eAAK,WACLA,eAAK,WACL+C,YACA/C,eAAK,sBAAuBqL,KAGxBE,EAAuBrI,eAAK,CAChClD,eAAK,QACLA,eAAK,OACLA,eAAK,SACL+C,YACA/C,eAAK,QAASsL,GACdtL,eAAK,uBAODwL,EAAaC,+BAAoB,SAACC,GAAD,OAAe,4BAAOA,MAMtD,SAASC,IACd,OAAO7G,gBAAM,CACX8G,UAAW3K,UACX4K,YAAa5K,UACb6K,SAAU9M,MAAIM,SAIX,SAASyM,EAAKjC,EAA2BtG,GAC9C,OACI,gCACE,uBACIgH,UAAU,OACVC,MAAO,GAEPM,cAAeiB,YACfC,YAAa,SAAA1L,GAAC,OAAIuJ,EAvErB,CACLpK,IAAK,aAAcqI,OAsE4BxH,EAAEwH,WAE1CvE,EAAMoI,UACFxK,KAAI,kBAAM,+CACVM,mBAAkB,kBACjB8B,EAAMqI,YACDzK,KAAI,SAAAyK,GAAW,OAAI,4CAAmB,0BAAKA,OAC3CpK,YAAY,gEAAuC,sCAAvC,cAKxB+B,EAAMoI,UACFxK,KAAI,SAAAwK,GAAS,OACV,gBAAC,WAAD,CAAUpI,MAAOoI,EAAW9B,SAAU1I,cAAI0I,EAAUsB,GAAUvB,SAAU2B,OAE3E/J,YAAY,mCAMlB,SAASsE,EAAOC,EAAUxC,GAC/B,OAAQwC,EAAItG,KACV,IAAK,WAEH,GAA6B,YAAzB8D,EAAMoI,UAAU9J,KAClB,OAAOgD,gBAAMtB,GAEf,IAAMoI,EAAYpI,EAAMoI,UAAU7J,MAC5BqF,EAAM4E,SAAUhG,EAAIA,IAAK4F,GAKzBvG,EAAyB,CAJV,2BAChB7B,GADgB,IACToI,UAAW5K,eAAKoG,EAAI,MAEVA,EAAI,GAAGhG,IAAIgK,IAIjC,OADyChE,EAAI,GAGxChG,KAAI,SAAA8K,GACH,OAAQA,EAAIxM,KACV,IAAK,gBACH,OAAOyM,EAAU3I,GACnB,IAAK,gBACH,OAAO2I,EAAU3I,EAAOxC,eAAKkL,EAAI1G,WAGtC/D,YAAY4D,GAEnB,IAAK,aAEH,OAAOP,gBAAM,2BAAItB,GAAL,IAAYsI,SAAU9F,EAAI3G,OAExC,IAAK,aAEH,OAAmB,IAAf2G,EAAI+B,OACCqE,EAAW5I,EAAOwI,OAAQT,EAAQ/H,EAAMsI,WAE1ChH,gBAAMtB,GAEf,IAAK,WAEH,MAAgB,gBAAZwC,EAAIlG,IACCsM,EAAW5I,EAAOwI,OAAQT,EAAQ/H,EAAMsI,WAE1ChH,gBAAMtB,IAKnB,IAAM+D,EAAiB,IAAIC,iBAEpB,SAAS6E,EAAc7I,GAE5B,IAAM8I,EAAoB9I,EAAMoI,UAC3BxK,KAAI,SAAAmL,GAAE,OAAIP,gBAAiBO,GAAInL,IAAIgK,MACnC1J,mBAAkB,kBAAM+F,MAAIe,UAE3BgE,EAAsBjF,EAAeG,GAAG,aAAa,SAAAnH,GAAC,MAhJrD,CACLb,IAAK,aAAcL,IA+IuD2M,MAAOzL,EAAEkM,MAAOlM,EAAEmM,WACxFC,EAAoBpF,EAAeG,GAAG,WAAW,SAAAnH,GAAC,MA3IjD,CACLb,IAAK,WAAYI,IA0ImDS,EAAET,QACxE,OAAO2H,MAAIlD,MAAM,CAAC+H,EAASE,EAAWG,IAOxC,SAASP,EAAW5I,EAAc6B,GAChC,OAAOM,QAAMgD,WAAWtD,GACnBuD,UAAS,SAAA2D,GAAE,kCAAS/I,GAAT,IAAgBoI,UAAW5K,eAAKuL,QAC3CzD,WAAU,SAAA8D,GAAE,OAAIA,EAAGxL,IAAIgK,MACvBpC,WAGP,SAASmD,EAAU3I,GAAwE,IAA1DqI,EAAyD,uDAA5B5K,UAC5D,OAAO6D,gBAAM,2BAAItB,GAAL,IAAYoI,UAAW3K,UAAS4K,iBC1L/BgB,MAZf,WACE,OACI,kBAAC,UAAD,CACIlB,KAAMmB,EACNf,KAAMe,EACN/G,OAAQ+G,EACRT,cAAeS,EACfC,SAAUC,WAASrB,KAA2BhE,WCPxDsF,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEF3K,SAASC,eAAe,W","file":"static/js/main.e700aaa8.chunk.js","sourcesContent":["/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Pos {\n  constructor(\n      readonly x: number,\n      readonly y: number,\n  ) {\n  }\n\n  add(p: Pos): Pos {\n    return new Pos(\n      this.x + p.x,\n      this.y + p.y\n    )\n  }\n\n  static origin: Pos = pos(0, 0)\n}\n\nexport function pos(x: number, y: number): Pos {\n  return new Pos(x, y);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Dim {\n  constructor(\n      readonly w: number,\n      readonly h: number,\n  ) {\n  }\n}\n\nexport function dim(w: number, h: number): Dim {\n  return new Dim(w, h);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {Dim} from \"./Dim\";\nimport {Box} from \"./Box\";\nimport {Result} from \"react-tea-cup\";\nimport {Menu, MenuItem} from \"./Menu\";\n\nexport type Msg<T>\n    = { tag: 'got-window-dimensions', d: Dim }\n    | { tag: 'got-uuid', uuid: string }\n    | { tag: 'got-menu-box', r: Result<Error, Box> }\n    | { tag: 'key-down', key: string }\n    | { tag: 'mouse-enter', item: MenuItem<T>, itemIndex: number }\n    | { tag: 'mouse-leave', item: MenuItem<T>, itemIndex: number }\n    | { tag: 'got-item-box', item: MenuItem<T>, r: Result<Error,Box>, selectFirst: boolean, subMenuCounter: number }\n    | { tag: 'item-clicked', item: MenuItem<T> }\n    | { tag: 'child-msg', m: Msg<T> }\n    | { tag: 'doc-mouse-down' }\n    | { tag: 'noop' };\n\nexport function noop<T>(): Msg<T> {\n  return { tag: 'noop' };\n}\n\nexport function gotWindowDimensions<T>(d: Dim): Msg<T> {\n  return {\n    tag: 'got-window-dimensions',\n    d\n  }\n}\n\nexport function gotUuid<T>(uuid: string): Msg<T> {\n  return {\n    tag: \"got-uuid\",\n    uuid\n  }\n}\n\nexport function gotMenuBox<T>(r: Result<Error, Box>): Msg<T> {\n  return {\n    tag: 'got-menu-box',\n    r\n  }\n}\n\nexport function gotKeyDown<T>(key: string): Msg<T> {\n  return {\n    tag: \"key-down\",\n    key\n  }\n}\n\nexport function childMsg<T>(m: Msg<T>): Msg<T> {\n  return {\n    tag: 'child-msg',\n    m\n  }\n}\n\nexport function gotItemBox<T>(item: MenuItem<T>, r: Result<Error,Box>, subMenuCounter: number, selectFirst: boolean): Msg<T> {\n  return {\n    tag: 'got-item-box',\n    item,\n    selectFirst,\n    r,\n    subMenuCounter\n  }\n}\n\nexport function docMouseDown<T>(): Msg<T> {\n  return {\n    tag: 'doc-mouse-down'\n  }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  just,\n  ListWithSelection,\n  Maybe,\n  maybeOf,\n  nothing,\n  Task,\n} from 'react-tea-cup';\n\nexport class Menu<T> {\n  constructor(private readonly elements: ListWithSelection<MenuElement<T>>) {}\n\n  selectFirstItem(): Menu<T> {\n    return new Menu(this.elements.selectIndex(0));\n  }\n\n  selectItem(item: MenuItem<T>): Menu<T> {\n    return new Menu(this.elements.select((e) => e === item));\n  }\n\n  deselectAll(): Menu<T> {\n    return new Menu(ListWithSelection.fromArray(this.elements.toArray()));\n  }\n\n  get elems(): ReadonlyArray<MenuElement<T>> {\n    return this.elements.toArray();\n  }\n\n  get selectedItem(): Maybe<MenuItem<T>> {\n    const selected = this.elements.getSelected();\n    if (selected.type === 'Just' && selected.value.tag === 'item') {\n      return just(selected.value);\n    }\n    return nothing;\n  }\n\n  isSelected(item: MenuItem<T>): boolean {\n    return this.elements.isSelected(item);\n  }\n\n  private findNextItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === elems.length - 1 ? 0 : start + 1;\n    for (let i = s; i < elems.length; i++) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  private findPreviousItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === 0 ? elems.length - 1 : start - 1;\n    for (let i = s; i >= 0; i--) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  moveSelection(down: boolean): Menu<T> {\n    return this.elements\n      .getSelectedIndex()\n      .map((selectedIndex) => {\n        const mbNextIndex = down\n          ? this.findNextItemIndex(selectedIndex)\n          : this.findPreviousItemIndex(selectedIndex);\n        return mbNextIndex\n          .map((nextIndex) => new Menu(this.elements.selectIndex(nextIndex)))\n          .withDefault(this);\n      })\n      .withDefaultSupply(() => {\n        return new Menu(\n          this.elements.selectIndex(down ? 0 : this.elements.length() - 1),\n        );\n      });\n  }\n\n  indexOfItem(item: MenuItem<T>): Maybe<number> {\n    const i = this.elements.toArray().indexOf(item);\n    if (i === -1) {\n      return nothing;\n    }\n    return just(i);\n  }\n}\n\nexport type MenuElement<T> = MenuItem<T> | MenuSeparator;\n\nexport interface MenuItem<T> {\n  tag: 'item';\n  readonly userData: T;\n  readonly subMenu: Maybe<Menu<T>>;\n}\n\nexport interface MenuSeparator {\n  tag: 'separator';\n}\n\nexport function menu<T>(items: ReadonlyArray<MenuElement<T>>): Menu<T> {\n  return new Menu(ListWithSelection.fromArray(items));\n}\n\nexport function item<T>(userData: T, subMenu?: Menu<T>): MenuItem<T> {\n  return {\n    tag: 'item',\n    userData,\n    subMenu: maybeOf(subMenu),\n  };\n}\n\nexport const separator: MenuSeparator = {\n  tag: 'separator',\n};\n\nexport function menuId(uuid: string): string {\n  return `tm-${btoa(uuid)}`;\n}\n\nexport function menuItemId(menuId: string, itemIndex: number): string {\n  return `tm-item-${menuId}-${itemIndex}`;\n}\n\nexport function menuTask(uuid: string): Task<Error, HTMLElement> {\n  return byId(menuId(uuid));\n}\n\nexport function menuItemTask(\n  menuId: string,\n  itemIndex: number,\n): Task<Error, HTMLElement> {\n  return byId(menuItemId(menuId, itemIndex));\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (e === null) {\n      throw new Error('element not found with id:' + id);\n    }\n    return e;\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {Menu} from \"./Menu\";\nimport {Maybe, nothing} from \"react-tea-cup\";\nimport {Dim} from \"./Dim\";\nimport {Box} from \"./Box\";\nimport {Pos} from \"./Pos\";\n\nexport interface Model<T> {\n  readonly uuid: Maybe<string>;\n  readonly windowSize: Maybe<Dim>;\n  readonly menu: Menu<T>;\n  readonly state: MenuState;\n  readonly error: Maybe<Error>;\n  readonly child: Maybe<Model<T>>;\n  readonly navigatedWithKeyboard: boolean;\n  readonly subMenuCounter: number;\n}\n\nexport function initialModel<T>(menu: Menu<T>, position: Pos): Model<T> {\n  return {\n    uuid: nothing,\n    windowSize: nothing,\n    menu,\n    state: menuStatePlacing(position),\n    error: nothing,\n    child: nothing,\n    navigatedWithKeyboard: false,\n    subMenuCounter: 0,\n  }\n}\n\nexport type MenuState =\n    | { tag: 'placing', position: Pos }\n    | { tag: 'open', box: Box };\n\nexport function menuStatePlacing(position: Pos): MenuState {\n  return {\n    tag: 'placing',\n    position\n  }\n}\n\nexport function keyboardNavigated<T>(model: Model<T>, navigatedWithKeyboard: boolean = true): Model<T> {\n  return {...model, navigatedWithKeyboard }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\n import {pos, Pos} from \"./Pos\";\nimport {dim, Dim} from \"./Dim\";\n\nexport class Box {\n  constructor(\n      readonly p: Pos,\n      readonly d: Dim\n  ) {\n  }\n\n  static fromDomRect(rect: DOMRect): Box {\n    const {x, y, height, width} = rect;\n    return box(pos(x,y), dim(width, height));\n  }\n\n}\n\nexport function box(p: Pos, d: Dim): Box {\n  return new Box(p, d);\n}\n\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {EventHandler} from \"react\";\n\nexport const stopEvent: EventHandler<any> = e => {\n  e.preventDefault();\n  e.stopPropagation();\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport * from './Model'\nexport * from './Msg'\nexport * from './Menu'\nexport * from './TeaPop'\nexport * from './ViewMenu'\nexport * from './OutMsg'\nexport * from './StopEvent'\nexport * from './Pos'\nexport * from './Dim'\nexport * from './ItemRenderer'\n\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  childMsg,\n  docMouseDown,\n  gotItemBox,\n  gotKeyDown,\n  gotMenuBox,\n  gotUuid,\n  gotWindowDimensions,\n  Msg,\n  noop,\n} from './Msg';\nimport {Cmd, DocumentEvents, just, Maybe, noCmd, nothing, Sub, Task, Tuple, uuid, WindowEvents,} from 'react-tea-cup';\nimport {initialModel, keyboardNavigated, Model} from './Model';\nimport {item, Menu, MenuItem, menuItemTask, menuTask,} from './Menu';\nimport {pos, Pos} from './Pos';\nimport {dim, Dim} from './Dim';\nimport {Box} from './Box';\nimport {adjustPopover} from './Popover';\nimport {OutMsg} from \"./OutMsg\";\n\nexport function open<T>(menu: Menu<T>, position: Pos, selectFirst: boolean = false): [Model<T>, Cmd<Msg<T>>] {\n  return [\n    initialModel(selectFirst ? menu.selectFirstItem() : menu.deselectAll(), position),\n    Cmd.batch([\n      Task.perform(getWindowDimensions, (d) => gotWindowDimensions(d)),\n      Task.perform(uuid(), (u) => gotUuid(u)),\n    ]),\n  ];\n}\n\nfunction postOpen<T>(\n    model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>] {\n  if (model.uuid.type === 'Nothing') {\n    return noCmd(model);\n  }\n  if (model.windowSize.type === 'Nothing') {\n    return noCmd(model);\n  }\n  const cmd: Cmd<Msg<T>> = Task.attempt(\n      menuTask(model.uuid.value).map((e) => Box.fromDomRect(e.getBoundingClientRect())),\n      (x) => gotMenuBox(x),\n  );\n  return [model, cmd];\n}\n\nfunction withOut<T>(mac: [Model<T>, Cmd<Msg<T>>], outMsg: Maybe<OutMsg<T>> = nothing): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return [mac[0], mac[1], outMsg];\n}\n\nexport function update<T>(\n    msg: Msg<T>,\n    model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (msg.tag) {\n    case 'got-window-dimensions': {\n      return withOut(postOpen({\n        ...model,\n        windowSize: just(msg.d),\n      }));\n    }\n    case 'got-uuid': {\n      return withOut(postOpen({\n        ...model,\n        uuid: just(msg.uuid),\n      }));\n    }\n    case 'got-menu-box': {\n      return withOut(noCmd(\n          model.windowSize\n              .map((windowSize) => {\n                const newModel: Model<T> = msg.r.match(\n                    (box) =>\n                        ({\n                          ...model,\n                          state: {\n                            tag: 'open',\n                            box: adjustPopover(windowSize, box),\n                          },\n                        } as Model<T>),\n                    (err) => ({\n                      ...model,\n                      error: just(err),\n                    }),\n                );\n                return newModel;\n              })\n              .withDefault(model),\n      ));\n    }\n\n    case 'key-down': {\n      switch (msg.key) {\n        case 'Escape': {\n          return withOut(\n              collapseLastSubMenu(keyboardNavigated(model)),\n              model.child.isNothing() ? just({ tag: 'request-close' }) : nothing\n          );\n        }\n        case 'ArrowDown':\n        case 'ArrowUp': {\n          return mapLastMenu(keyboardNavigated(model), (lastModel) => {\n            return withOut(noCmd({\n              ...lastModel,\n              menu: lastModel.menu.moveSelection(msg.key === 'ArrowDown'),\n            }));\n          });\n        }\n        case 'ArrowLeft':\n          return withOut(collapseLastSubMenu(keyboardNavigated(model)));\n        case 'ArrowRight':\n          return expandLastSubMenu(keyboardNavigated(model));\n        case 'Enter':\n        case ' ': {\n          return toggleOrSelectItem(model);\n        }\n        default:\n          return withOut(noCmd(model));\n      }\n    }\n    case 'mouse-enter': {\n      const newModel = { ...model, subMenuCounter: model.subMenuCounter + 1 };\n      if (model.navigatedWithKeyboard) {\n        return withOut(noCmd(keyboardNavigated(newModel, false)));\n      }\n      if (model.uuid.type === 'Nothing') {\n        return withOut(noCmd(newModel));\n      }\n      const menu = model.menu.selectItem(msg.item);\n      const uuid = model.uuid.value;\n      return withOut(\n          openSubMenu({...newModel, menu, child: nothing}, uuid, msg.item, msg.itemIndex, false)\n      );\n    }\n    case \"mouse-leave\": {\n      return withOut(\n          noCmd(\n              model.child.isJust()\n                ? model\n                : { ...model, menu: model.menu.deselectAll() }\n          )\n      );\n    }\n    case 'got-item-box': {\n      if (msg.subMenuCounter !== model.subMenuCounter) {\n        return withOut(noCmd(model));\n      }\n      return withOut(msg.r.match(\n        (itemBox) => {\n          const newModel: Model<T> = {\n            ...model,\n            menu: model.menu.selectItem(msg.item),\n          };\n          return msg.item.subMenu\n              .map((subMenu) => {\n                // we have a sub menu so we need\n                // to open a new Menu !\n                const mac = open(\n                    subMenu,\n                    itemBox.p.add(pos(itemBox.d.w, 0)),\n                    msg.selectFirst\n                );\n                const newModel2: Model<T> = {\n                  ...newModel,\n                  child: just(mac[0]),\n                };\n                return Tuple.t2n(newModel2, mac[1].map(childMsg));\n              })\n              .withDefaultSupply(() => {\n                // close any existing child !\n                return newModel.child\n                    .map(() => noCmd<Model<T>, Msg<T>>({...model, child: nothing}))\n                    .withDefaultSupply(() => noCmd(model));\n              });\n        },\n        (err) => noCmd({...model, error: just(err)}),\n      ));\n    }\n    case 'child-msg': {\n      return model.child\n          .map((child) => {\n            const mco = update(msg.m, child);\n            const newModel: Model<T> = {\n              ...model,\n              child: just(mco[0]),\n            };\n            return withOut(Tuple.t2n(newModel, mco[1].map(childMsg)), mco[2]);\n          })\n          .withDefaultSupply(() => withOut(noCmd(model)));\n    }\n    case \"item-clicked\": {\n      return withOut(noCmd(model), outItemSelected(msg.item))\n    }\n    case \"doc-mouse-down\": {\n      return withOut(noCmd(model), just({tag: 'request-close'}))\n    }\n    case \"noop\": {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction outItemSelected<T>(item: MenuItem<T>): Maybe<OutMsg<T>> {\n  return just({tag:\"item-selected\", data: item.userData});\n}\n\nfunction openSubMenu<T>(\n    model: Model<T>,\n    menuId: string,\n    item: MenuItem<T>,\n    itemIndex: number,\n    selectFirst: boolean,\n): [Model<T>, Cmd<Msg<T>>] {\n  if (item.subMenu.isNothing()) {\n    return noCmd(model);\n  }\n  const subMenuCounter = model.subMenuCounter + 1;\n  return Tuple.t2n(\n      { ...model, subMenuCounter },\n      Task.attempt(\n        menuItemTask(menuId, itemIndex).map((e) => {\n          return Box.fromDomRect(e.getBoundingClientRect());\n        }),\n        (r) => gotItemBox(item, r, subMenuCounter, selectFirst),\n      )\n  );\n}\n\nconst windowEvents = new WindowEvents();\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions<T>(model: Model<T>): Sub<Msg<T>> {\n  return Sub.batch([\n    windowEvents.on('resize', () =>\n        gotWindowDimensions(dim(window.innerWidth, window.innerHeight)),\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      if (evt.button === 2) {\n        return noop();\n      }\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop Menu !\n        if (t.classList.contains(\"tm\")) {\n          return noop();\n        }\n        t = t.parentElement;\n      }\n      return docMouseDown();\n    }),\n    model.state.tag === 'open'\n        ? documentEvents.on('keydown', (e) => gotKeyDown(e.key))\n        : Sub.none(),\n  ]);\n}\n\nconst getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n    dim(window.innerWidth, window.innerHeight),\n);\n\nfunction mapLastMenu<T>(\n    model: Model<T>,\n    f: (m: Model<T>) => [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>],\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing': {\n      // I'm the last model !\n      return f(model);\n    }\n    case 'Just': {\n      const mac = mapLastMenu(model.child.value, f);\n      return [{...model, child: just(mac[0])}, mac[1].map(childMsg), mac[2]];\n    }\n  }\n}\n\nfunction collapseLastSubMenu<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  switch (model.child.type) {\n    case \"Nothing\":\n      return noCmd(model);\n    case \"Just\": {\n      // I have a child : close it if he has no child !\n      const child = model.child.value;\n      if (child.child.isJust()) {\n        return Tuple.fromNative(collapseLastSubMenu(child))\n            .mapFirst(c => ({...model, child: just(c)}))\n            .mapSecond(cmd => cmd.map(childMsg))\n            .toNative();\n      } else {\n        return noCmd({\n          ...model,\n          child: nothing\n        })\n      }\n    }\n  }\n}\n\nfunction expandLastSubMenu<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n        .map((selectedItem) => {\n          return selectedItem.subMenu\n              .map(() => {\n                if (lastModel.uuid.type === 'Nothing') {\n                  return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n                }\n                const uuid = lastModel.uuid.value;\n                const mac: [Model<T>, Cmd<Msg<T>>] =\n                lastModel.menu\n                    .indexOfItem(selectedItem)\n                    .map((itemIndex) => {\n                      return openSubMenu(lastModel, uuid, selectedItem, itemIndex, true);\n                    })\n                    .withDefaultSupply(() => noCmd(lastModel));\n                return withOut(mac);\n              })\n              .withDefaultSupply(() => {\n                return withOut(noCmd(lastModel));\n              });\n        })\n        .withDefaultSupply(() => {\n          return withOut(noCmd(lastModel));\n        });\n  });\n}\n\nfunction toggleOrSelectItem<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n        .map(selectedItem => {\n          if (lastModel.uuid.type === 'Nothing') {\n            return withOut(noCmd<Model<T>,Msg<T>>(lastModel));\n          }\n          const uuid = lastModel.uuid.value;\n          // do we have a sub-menu ?\n          return selectedItem.subMenu\n              .map(() => {\n                // we have a sub-menu, expand it\n                const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n                    .indexOfItem(selectedItem)\n                    .map(itemIndex => openSubMenu(lastModel, uuid, selectedItem, itemIndex, true))\n                    .withDefaultSupply(() => noCmd(lastModel))\n                return withOut(mac);\n              })\n              .withDefaultSupply(() => {\n                // no sub-menu, select the item\n                return withOut(noCmd(lastModel), outItemSelected(selectedItem));\n              })\n\n        })\n        .withDefaultSupply(() => withOut(noCmd(lastModel)))\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {box, Box} from \"./Box\";\nimport {dim, Dim} from \"./Dim\";\nimport {pos} from \"./Pos\";\n\nexport function adjustPopover(viewport: Dim, elem: Box): Box {\n\n  // display above or below and shrink size if necessary\n\n  const {x, y} = elem.p;\n  const {h, w} = elem.d;\n  const { h:vh, w:vw } = viewport;\n\n  let newY = y;\n  let newH = h;\n  const overflowDown = (y + h) - vh;\n  if (overflowDown > 0) {\n    // would overflow the bottom, check if we have enough space to move up\n    if (y > overflowDown) {\n      // enough space, move pos up\n      newY = y - overflowDown;\n    } else {\n      // not enough space, shrink the box to the viewport's height\n      newY = 0;\n      newH = vh;\n    }\n  }\n\n  let newX = x;\n  let newW = w;\n  const overflowRight = (x + w) - vw;\n  if (overflowRight > 0) {\n    // would overflow on the right, check if we have enough space to move left\n    if (x > overflowRight) {\n      // enough space, move left\n      newX = x - overflowRight;\n    } else {\n      newX = 0;\n      newW = vw;\n    }\n  }\n\n  return box(pos(newX, newY), dim(newW, newH));\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport {Menu, menuId, MenuItem, menuItemId} from \"./Menu\";\nimport {childMsg, Msg} from \"./Msg\";\nimport {Dispatcher, map} from \"react-tea-cup\";\nimport {ItemRenderer} from \"./ItemRenderer\";\nimport {Model} from \"./Model\";\nimport {stopEvent} from \"./StopEvent\";\n\nexport interface ViewMenuProps<T> {\n  model: Model<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenu<T>(props: ViewMenuProps<T>) {\n  const {model, dispatch, renderer} = props;\n  const {menu, state, uuid, windowSize} = model;\n  if (uuid.type === 'Nothing') {\n    return <></>;\n  }\n  if (windowSize.type === 'Nothing') {\n    return <></>;\n  }\n\n  const renderItems = () => menu.elems.map((element, index) => {\n    switch (element.tag) {\n      case \"item\": {\n        return (\n            <ViewMenuItem\n                key={`item-${index}`}\n                uuid={uuid.value}\n                itemIndex={index}\n                menu={menu}\n                item={element}\n                {...props}\n            />\n        )\n      }\n      case \"separator\": {\n        return (\n            <div key={`sep-${index}`} className=\"tm-separator\"/>\n        )\n      }\n    }\n  });\n\n  switch (state.tag) {\n    case \"placing\": {\n      const {position} = state;\n      return (\n          <div\n              className=\"tm-placer\"\n              style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                bottom: 0,\n                right: 0,\n                overflow: \"hidden\",\n              }}\n              onContextMenu={stopEvent}\n          >\n            <div\n                className=\"tm\"\n                id={menuId(uuid.value)}\n                style={{\n                  position: \"absolute\",\n                  top: position.y,\n                  left: position.x,\n                  visibility: \"hidden\",\n                }}\n                onContextMenu={stopEvent}\n            >\n              {renderItems()}\n            </div>\n          </div>\n      )\n    }\n    case \"open\": {\n      const {box} = state;\n      const {p, d} = box;\n      return (\n          <>\n            <div\n                className=\"tm\"\n                id={menuId(uuid.value)}\n                style={{\n                  position: \"absolute\",\n                  top: p.y,\n                  left: p.x,\n                  width: d.w,\n                  height: d.h\n                }}\n                onContextMenu={stopEvent}\n            >\n              {renderItems()}\n            </div>\n            {model.child\n                .map(child =>\n                    <ViewMenu model={child} dispatch={map(dispatch, childMsg)} renderer={renderer}/>\n                )\n                .withDefaultSupply(() => <></>)\n            }\n          </>\n      )\n    }\n  }\n}\n\nexport interface ViewMenuItemProps<T> {\n  uuid: string;\n  itemIndex: number;\n  menu: Menu<T>;\n  item: MenuItem<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenuItem<T>(props: ViewMenuItemProps<T>) {\n  const {menu, item, renderer, dispatch, uuid, itemIndex} = props;\n  const selected = menu.isSelected(item);\n  return (\n      <div\n          id={menuItemId(uuid, itemIndex)}\n          onMouseEnter={() => dispatch({ tag: 'mouse-enter', item, itemIndex })}\n          onMouseLeave={() => dispatch({ tag: 'mouse-leave', item, itemIndex })}\n          onClick={() => {\n            dispatch({tag: 'item-clicked', item})\n          }}\n      >\n        {renderer({\n          data: item.userData,\n          active: selected,\n          hasSubMenu: item.subMenu.isJust(),\n        })}\n      </div>\n  );\n}\n\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from \"react\";\n\nexport interface RendererInput<T> {\n  readonly data: T;\n  readonly active: boolean;\n  readonly hasSubMenu: boolean;\n}\n\nexport type ItemRenderer<T> = (input: RendererInput<T>) => React.ReactNode;\n\nexport function defaultItemRenderer<T>(contentRenderer: (t: T) => React.ReactNode): ItemRenderer<T> {\n  return (input) => {\n    const { data, active, hasSubMenu } = input;\n    const activeClass = active ? ' tm-active' : '';\n    return (\n        <div className={`tm-item${activeClass}`}>\n          <div className=\"tm-item__content\">\n            {contentRenderer(data)}\n          </div>\n          { hasSubMenu\n              ? (\n                  <div className=\"tm-item__submenu\">\n                    ›\n                  </div>\n              )\n              : <></>\n          }\n        </div>\n    )\n  }\n}\n","import {Cmd, Dispatcher, DocumentEvents, just, map, Maybe, noCmd, nothing, Sub, Tuple} from \"react-tea-cup\";\nimport * as React from 'react';\nimport * as TM from 'tea-pop';\nimport {defaultItemRenderer, item, Menu, menu, Model as TModel, Msg as TMsg, Pos, separator, ViewMenu} from 'tea-pop';\n\nexport interface Model {\n  // keep track of mouse position\n  readonly mousePos: Pos;\n  // ref to the tea-pop model\n  readonly menuModel: Maybe<TModel<string>>;\n  // keep last clicked item\n  readonly lastClicked: Maybe<string>;\n}\n\n// just to avoid too much typing\nexport type MenuModel = TModel<string>\nexport type MenuMsg = TMsg<string>\n\n/*\n * Msg\n */\n\nexport type Msg =\n    | { tag: 'menu-msg', msg: MenuMsg }\n    | { tag: 'mouse-down', button: number }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'key-down', key: string }\n\nfunction menuMsg(msg: MenuMsg): Msg {\n  return {\n    tag: \"menu-msg\",\n    msg\n  }\n}\n\nfunction onMouseDown(button: number): Msg {\n  return {\n    tag: \"mouse-down\", button\n  }\n}\n\nfunction onMouseMove(pos: Pos): Msg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nfunction onKeyDown(key: string): Msg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n\n/*\n * We keep our menus as constants. Those are, like everything, immutable.\n * They will serve as prototypes for when we open menus in reaction to clicks or\n * keystrokes...\n * We use strings for our data types, but it could hold a richer data type.\n */\n\nconst mySubMenu2: Menu<string> = menu([\n  item(\"Try\"),\n  item(\"Finally\")\n])\n\nconst mySubMenu1: Menu<string> = menu([\n  item(\"Do this\"),\n  item(\"Do that\"),\n  separator,\n  item(\"Another sub menu...\", mySubMenu2)\n])\n\nconst myMenu: Menu<string> = menu([\n  item(\"Copy\"),\n  item(\"Cut\"),\n  item(\"Paste\"),\n  separator,\n  item(\"Yalla\", mySubMenu1),\n  item(\"I am a bit longer\")\n]);\n\n/**\n * We use the default item renderer with our item data type (string).\n */\n\nconst MyRenderer = defaultItemRenderer((s: string) => <span>{s}</span>);\n\n/*\n * init, view, update, subs...\n */\n\nexport function init(): [Model, Cmd<Msg>] {\n  return noCmd({\n    menuModel: nothing,\n    lastClicked: nothing,\n    mousePos: Pos.origin\n  });\n}\n\nexport function view(dispatch: Dispatcher<Msg>, model: Model) {\n  return (\n      <>\n        <div\n            className=\"demo\"\n            style={{\n            }}\n            onContextMenu={TM.stopEvent}\n            onMouseDown={e => dispatch(onMouseDown(e.button))}\n        >\n          {model.menuModel\n              .map(() => <span>Menu is open</span>)\n              .withDefaultSupply(() =>\n                model.lastClicked\n                    .map(lastClicked => <span>You selected <em>{lastClicked}</em></span>)\n                    .withDefault(<span>Right-click anywhere, or use the <code>≣</code> key.</span>)\n              )\n          }\n        </div>\n        {/* include the Menu if it's open */}\n        {model.menuModel\n            .map(menuModel =>\n                <ViewMenu model={menuModel} dispatch={map(dispatch, menuMsg)} renderer={MyRenderer}/>\n            )\n            .withDefault(<></>)\n        }\n      </>\n  )\n}\n\nexport function update(msg: Msg, model: Model): [Model, Cmd<Msg>] {\n  switch (msg.tag) {\n    case \"menu-msg\": {\n      // got child msg, update our child...\n      if (model.menuModel.type === 'Nothing') {\n        return noCmd(model);\n      }\n      const menuModel = model.menuModel.value;\n      const mco = TM.update(msg.msg, menuModel);\n      const newModel: Model = {\n        ...model, menuModel: just(mco[0])\n      };\n      const cmd: Cmd<Msg> = mco[1].map(menuMsg);\n      const mac: [Model, Cmd<Msg>] = [newModel, cmd];\n      // and handle its out msg if needed\n      const outMsg: Maybe<TM.OutMsg<string>> = mco[2];\n      return outMsg\n          // eslint-disable-next-line array-callback-return\n          .map(out => {\n            switch (out.tag) {\n              case \"request-close\":\n                return closeMenu(model);\n              case \"item-selected\":\n                return closeMenu(model, just(out.data));\n            }\n          })\n          .withDefault(mac);\n    }\n    case \"mouse-move\": {\n      // keep track of the mouse pos (needed for opening with keyboard)\n      return noCmd({...model, mousePos: msg.pos })\n    }\n    case \"mouse-down\": {\n      // open menu on right click\n      if (msg.button === 2) {\n        return updateMenu(model, TM.open(myMenu, model.mousePos));\n      }\n      return noCmd(model);\n    }\n    case \"key-down\": {\n      // open menu on context menu key\n      if (msg.key === 'ContextMenu') {\n        return updateMenu(model, TM.open(myMenu, model.mousePos));\n      }\n      return noCmd(model);\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions(model: Model): Sub<Msg> {\n  // the menu's subs\n  const menuSub: Sub<Msg> = model.menuModel\n      .map(mm => TM.subscriptions(mm).map(menuMsg))\n      .withDefaultSupply(() => Sub.none());\n  // mouse & key subs\n  const mouseMove: Sub<Msg> = documentEvents.on('mousemove', e => onMouseMove(TM.pos(e.pageX, e.pageY)));\n  const keyDown: Sub<Msg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n  return Sub.batch([menuSub, mouseMove, keyDown]);\n}\n\n/*\n * Helper functions\n */\n\nfunction updateMenu(model: Model, mac: [MenuModel, Cmd<MenuMsg>]): [Model, Cmd<Msg>] {\n  return Tuple.fromNative(mac)\n      .mapFirst(mm => ({...model, menuModel: just(mm)}))\n      .mapSecond(mc => mc.map(menuMsg))\n      .toNative();\n}\n\nfunction closeMenu(model: Model, lastClicked: Maybe<string> = nothing): [Model, Cmd<Msg>] {\n  return noCmd({...model, menuModel: nothing, lastClicked })\n}\n\n","import React from 'react';\nimport './App.scss';\nimport {DevTools, Program} from \"react-tea-cup\";\nimport * as Demo from './Demo';\n\nfunction App() {\n  return (\n      <Program\n          init={Demo.init}\n          view={Demo.view}\n          update={Demo.update}\n          subscriptions={Demo.subscriptions}\n          devTools={DevTools.init<Demo.Model, Demo.Msg>(window)}\n      />\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}